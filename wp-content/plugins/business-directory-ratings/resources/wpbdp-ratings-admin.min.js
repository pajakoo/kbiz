function wpbdp_raty_this(v){var $obj=jQuery(v),rating=$obj.attr("data-value"),readOnly=!1,scoreName=$obj.attr("data-field")?$obj.attr("data-field"):"score";"undefined"!=typeof $obj.attr("data-readonly")&&(readOnly=!0);$obj.raty({number:WPBDP.ratings._config.number,halfShow:!0,score:rating,readOnly:readOnly,path:WPBDP.ratings._config.path,scoreName:scoreName})}jQuery(function($){var $stars=jQuery(".wpbdp-ratings-stars");$stars.each(function(i,v){wpbdp_raty_this(v)});$("#wpbdp-ratings").on("click",".row-actions a.delete",function(e){e.preventDefault();var $rating=$(this).parents("tr"),rating_id=$rating.attr("data-id");$.post(WPBDP.ratings._config.ajaxurl,{action:"wpbdp-ratings",a:"delete",id:rating_id},function(res){if(res.success){$rating.remove();0==$("#wpbdp-ratings table tr:not(.no-items)").length&&$("#wpbdp-ratings table tr.no-items").show()}},"json")});$("#wpbdp-ratings").on("click",".row-actions a.edit",function(e){e.preventDefault();var $rating=$(this).parents("tr"),$editform=$(".comment-edit",$rating);$(".comment .comment",$rating).toggle();$editform.toggle()});$("#wpbdp-ratings").on("click",".comment-edit input.save-button",function(e){e.preventDefault();var $rating=$(this).parents("tr"),comment=$(".comment-edit textarea",$rating).val();$.post(WPBDP.ratings._config.ajaxurl,{action:"wpbdp-ratings",a:"edit",id:$rating.attr("data-id"),comment:comment},function(res){if(res.success){$(".comment-edit textarea",$rating).val(res.comment);$(".comment .comment",$rating).html(res.comment).show();$(".comment-edit",$rating).hide()}else alert(res.msg)},"json")});$("#wpbdp-ratings").on("click",".comment-edit input.cancel-button",function(e){e.preventDefault();var $rating=$(this).parents("tr");jQuery(".comment .comment",$rating).show();jQuery(".comment-edit",$rating).hide()});$("#wpbdp-ratings-admin-post-review .add-review-link").click(function(e){e.preventDefault();$(this).hide();$("#wpbdp-ratings-admin-post-review .form").fadeIn()});$("#wpbdp-ratings-admin-post-review .form a.button-secondary").click(function(e){e.preventDefault();$("#wpbdp-ratings-admin-post-review .form").fadeOut(function(){$("#wpbdp-ratings-admin-post-review .add-review-link").show()})});$("#wpbdp-ratings-admin-post-review .form a.button-primary").click(function(e){e.preventDefault();var listing=$.trim($('input[name="wpbdp_ratings_rating[listing_id]"]').val()),author=$.trim($('input[name="wpbdp_ratings_rating[user_name]"]').val()),rating=$.trim($('input[name="wpbdp_ratings_rating[rating]"]').val()),comment=$.trim($('textarea[name="wpbdp_ratings_rating[comment]"]').val()),request={action:"wpbdp-ratings-add","rating[listing_id]":listing,"rating[user_name]":author,"rating[rating]":rating,"rating[comment]":comment};$.post(ajaxurl,request,function(response){if(response.ok){var $new=jQuery(response.html);$("#wpbdp-ratings table tr.no-items").hide();$("#wpbdp-ratings table").prepend($new);$("#wpbdp-ratings-admin-post-review .form input").val("");$("#wpbdp-ratings-admin-post-review .form textarea").val("");$("#wpbdp-ratings-admin-post-review .form .wpbdp-ratings-stars").raty("score",0);$("#wpbdp-ratings-admin-post-review .form").hide();$("#wpbdp-ratings-admin-post-review .form a.button-secondary").click();wpbdp_raty_this($(".wpbdp-ratings-stars",$new))}else alert(response.errormsg?response.errormsg:"Unknown Error")},"json")})});